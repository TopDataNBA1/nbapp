<!-- AUTO-GENERATED: DO NOT EDIT MANUALLY --> 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOP DATA NBA LIVE v2.1</title>
    <link rel="manifest" href="/nbapp/manifest.json" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="2.1.<?php echo time(); ?>">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- ‚úÖ ONESIGNAL SDK - A√ëADIDO -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    
    <style>
        body{margin:0;padding:0;background:#0f0f1b;color:#e0e0e0;font-family:'Roboto',sans-serif;min-height:100vh;}
        .topbar{
            display:grid;
            grid-template-columns: auto 1fr auto;
            align-items:center;
            padding:12px 20px;
            background:rgba(0,0,0,0.9);
            border-bottom:3px solid #ff4655;
        }

        .topbar-left{
            display:flex;
            align-items:center;
        }

        .logo-img{
            height:56px;
        }

        .topbar-center{
            text-align:center;
        }

        .nbapp{
            font-family:'Orbitron',sans-serif;
            font-size:2.1em;
            color:#ff4655;
            text-shadow:0 0 10px #ff4655;
        }

        .topbar-right{
            display:flex;
            align-items:center;
            cursor:pointer;
        }

        .notif-icon{
            width:26px;
            height:26px;
            fill:none;
            stroke:#e0e0e0;
            stroke-width:1.8;
            transition:0.25s;
        }

        .topbar-right:hover .notif-icon{
            stroke:#ff4655;
            filter:drop-shadow(0 0 6px #ff4655);
        }

        .status-bar{padding:8px 20px;background:rgba(0,0,0,0.7);font-size:1.1em;text-align:center;}
        .status-line1{color:#55ff55;}
        .status-line2{color:#ffaa00;font-weight:600;}

        .tabs{max-width:900px;margin:15px auto;display:flex;border-radius:10px;overflow:hidden;box-shadow:0 4px 15px rgba(255,70,85,0.3);}
        .tab-btn{flex:1;padding:12px 8px;font-family:'Orbitron',sans-serif;font-size:1.1em;color:white;background:rgba(255,70,85,0.2);border:none;cursor:pointer;transition:0.3s;}
        .tab-btn:hover{background:rgba(255,70,85,0.4);}
        .tab-btn.active{background:#ff4655;box-shadow:0 0 12px #ff4655;}

        .tab-content{display:none;background:rgba(20,20,40,0.97);padding:10px;border-radius:0 0 10px 10px;}
        .tab-content.active{display:block;}
        .container{max-width:900px;margin:0 auto;}

        /* LATEST MOVES ‚Äì VERSI√ìN QUE T√ö AMAS + TUS 4 CAMBIOS */
        .moves-area{height:88vh;background:#1e1e2e;border-radius:16px;overflow:hidden;box-shadow:0 12px 40px rgba(255,70,85,0.4);display:flex;flex-direction:column;}
        .moves-list{flex:1;overflow-y:auto;padding:18px 12px;background:#0f0f1b;}
        .move-item{background:rgba(30,30,46,0.9);border-radius:14px;margin:14px 8px;padding:16px 14px;box-shadow:0 4px 12px rgba(0,0,0,0.5);}
        .move-photos{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:12px;}
        .move-photos img{width:78px;height:78px;border-radius:50%;object-fit:cover;border:4px solid #ff4655;box-shadow:0 0 15px rgba(255,70,85,0.6);}
        .move-text{font-size:1.01em;line-height:1.52;color:#e0e0e0;text-align:center;}
        .move-text strong{color:#ffaa00;font-weight:700;}
        .move-time{color:#888;font-size:0.89em;text-align:center;margin-top:10px;font-style:italic;}

        /* LIVE RANKINGS ‚Äì 100% COMO ANTES */
        .filters{display:flex;gap:10px;margin:12px 0;justify-content:center;padding:4px 0;overflow-x:auto;}
        .filter-btn{white-space:nowrap;padding:6px 11px;background:rgba(255,70,85,0.25);border:1px solid #ff4655;border-radius:6px;font-family:'Orbitron',sans-serif;font-size:0.86em;cursor:pointer;transition:0.3s;}
        .filter-btn.active{background:#ff4655;box-shadow:0 0 10px #ff4655;font-weight:bold;}

        .card{background:rgba(20,20,40,0.97);border-radius:8px;overflow:hidden;margin:10px 0;box-shadow:0 4px 12px rgba(0,0,0,0.6);}
        .card h2{margin:0;padding:8px;font-family:'Orbitron',sans-serif;font-size:1.15em;background:#ff4655;color:white;text-align:center;}
        table{width:100%;border-collapse:collapse;font-size:0.84em;}
        th,td{padding:5px 4px;border-bottom:1px solid #333;}
        th{background:#1a1a2e;position:sticky;top:0;font-size:0.88em;}
        .rank{color:#ffaa00;text-align:center;font-weight:bold;width:8%;}
        .player{text-align:left;font-weight:500;width:28%;}
        .number,.today,.diff{text-align:right;}
        .today{font-weight:bold;width:12%;}
        .diff{color:#ffaa00;width:10%;}
        .diff-blink{color:#ffaa00!important;font-weight:900;animation:blink 1.6s infinite;}
        @keyframes blink{0%,100%{opacity:1}50%{opacity:0.5}}
        .leyenda{text-align:center;padding:10px;background:rgba(255,70,85,0.15);border:1px solid #ff4655;border-radius:8px;font-size:0.9em;margin:10px 0;}
        .collage img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }
        /* Tama√±o m√°ximo de los collages de Latest Moves */
        .collage {
            max-width: 300px;      /* ancho m√°ximo de cada collage */
            max-height: 200px;     /* altura m√°xima del collage */
            margin: 0 auto 12px;
        }

        /* 1 FOTO ‚Üí ocupa todo el collage */
        .collage.c1 img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 2 FOTOS ‚Üí lado a lado */
        .collage.c2 {
            display: flex;
            gap: 6px;
        }
        .collage.c2 img {
            flex: 1;
            height: 100%;
            object-fit: cover;
        }

        /* 3 FOTOS ‚Üí 1 izquierda, 2 derecha en columna */
        .collage.c3 {
            display: flex;
            gap: 6px;
            height: 200px;  /* altura m√°xima */
        }
        .collage.c3 .left,
        .collage.c3 .right {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .collage.c3 .left img,
        .collage.c3 .right img {
            flex: 1;
            width: 100%;
            object-fit: cover;
        }

        /* 4 FOTOS ‚Üí grid 2x2 */
        .collage.c4 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 6px;
            height: 200px; /* altura m√°xima */
        }
        .collage.c4 img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
    /* OVERLAY */
    #notif-overlay{
        position:fixed;
        inset:0;
        background:rgba(0,0,0,0.75);
        z-index:3000;
        display:flex;
        justify-content:center;
        align-items:flex-start;
        padding-top:90px; /* debajo de la topbar */
    }  

    /* PANEL */
    #notif-panel{
        width:92%;
        max-width:460px;
        max-height:80vh;
        background:#141428;
        border:2px solid #ff4655;
        border-radius:18px;
        padding:18px 16px;
        overflow-y:auto;
        box-shadow:
            0 0 25px rgba(255,70,85,0.55),
            inset 0 0 30px rgba(255,255,255,0.03);
    }

    /* FILTER GROUP (NOTIFICATIONS PANEL ONLY) */
    .filter-group{
        margin-bottom:16px;
    }

    .filter-title{
        font-family:'Orbitron',sans-serif;
        font-size:0.9em;
        color:#ffaa00;
        margin-bottom:8px;
    }

    .filter-buttons{
        display:grid;
        gap:6px;
    }
    
    /* Stats: 2 filas de 4 */
    .filter-buttons[data-tag="stat"]{
        grid-template-columns: repeat(4, 1fr);
    }
    
    /* Teams: grid de 6 columnas */
    .filter-buttons[data-tag="team"]{
        grid-template-columns: repeat(6, 1fr);
    }
    
    /* Alert: 3 columnas iguales */
    .filter-buttons[data-tag="alert"]{
        grid-template-columns: repeat(3, 1fr);
    }
    
    /* Ranking: 4 columnas iguales */
    .filter-buttons[data-tag="ranking"]{
        grid-template-columns: repeat(4, 1fr);
    }

    .filter-buttons button{
        padding:8px 6px;
        background:rgba(80,80,100,0.25);
        border:1px solid #555;
        border-radius:6px;
        color:#e0e0e0;
        font-family:'Orbitron',sans-serif;
        font-size:0.78em;
        cursor:pointer;
        transition:0.25s;
        white-space:nowrap;
        text-align:center;
    }
    
    /* ALL en Teams ocupa toda la fila */
    .filter-buttons[data-tag="team"] button[data-value="ALL"]{
        grid-column: 1 / -1;
    }

    .filter-buttons button.active{
        background:#ff4655;
        border-color:#ff4655;
        color:white;
        box-shadow:0 0 8px rgba(255,70,85,0.6);
    }

    .save-btn,
    .disable-btn{
        width:100%;
        padding:12px;
        font-family:'Orbitron',sans-serif;
        font-size:1em;
        border:none;
        border-radius:8px;
        cursor:pointer;
        transition:0.3s;
    }

    .save-btn{
        background:#ff4655;
        color:white;
        font-weight:bold;
        margin-top:18px;
    }

    .save-btn:hover{
        background:#ff5566;
        box-shadow:0 0 12px rgba(255,70,85,0.8);
    }

    .disable-btn{
        background:rgba(180,180,180,0.2);
        border:1px solid #888;
        color:#bbb;
    }

    .disable-btn.active{
        background:rgba(80,80,100,0.6);
        border-color:#ff4655;
        color:white;
    }

    .hidden{
        display:none;
    }

    </style>
</head>
<body>

<div class="topbar">
  <div class="topbar-left">
    <img src="logo.png" alt="Logo" class="logo-img">
  </div>
  <div class="topbar-center">
    <div class="nbapp">Top Data NBApp</div>
  </div>
  <div class="topbar-right" onclick="openFilters()">
    <svg class="notif-icon" viewBox="0 0 24 24">
      <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"></path>
    </svg>
  </div>
</div>

<div id="status-bar" class="status-bar"></div>

<div class="tabs">
  <button class="tab-btn active" onclick="switchTab('latest-moves')">Latest Moves</button>
  <button class="tab-btn" onclick="switchTab('live-rankings')">Live Rankings</button>
</div>

<!-- TAB CONTENT (LATEST MOVES) -->
<div id="tab-latest-moves" class="tab-content active container">
  <div class="moves-area">
    <div id="moves-list" class="moves-list">
      <p style="text-align:center;color:#888;margin-top:60px;">Cargando...</p>
    </div>
  </div>
</div>

<!-- TAB CONTENT (LIVE RANKINGS) -->
<div id="tab-live-rankings" class="tab-content container">
  <div class="filters" id="filters-container"></div>
  <div class="leyenda">
    ‚úÖ <strong>Live</strong> ‚Üí jugando ahora mismo
    | ‚úîÔ∏è <strong>Final</strong> ‚Üí partido terminado
    | ‚è∏ <strong>Upcoming</strong> ‚Üí partido futuro
  </div>
  <div id="ranking-container"></div>
</div>

<div id="notif-overlay" class="hidden" onclick="closeFilters()">
  <div id="notif-panel" onclick="event.stopPropagation()">
    <!-- T√çTULO DEL PANEL -->
    <h3 style="font-family:'Orbitron',sans-serif;color:#ff4655;text-align:center;margin:0 0 20px 0;font-size:1.3em;">Choose which notifications you want to receive</h3>
    
    <!-- STATS FILTER -->
    <div class="filter-group">
      <div class="filter-title">Stats</div>
      <div class="filter-buttons" data-tag="stat">
        <button data-value="ALL">ALL</button>
        <button data-value="PTS">PTS</button>
        <button data-value="REB">REB</button>
        <button data-value="AST">AST</button>
        <button data-value="STL">STL</button>
        <button data-value="BLK">BLK</button>
        <button data-value="3PM">3PM</button>
        <button data-value="G">GAMES</button>
      </div>
    </div>

    <!-- TEAMS FILTER -->
    <div class="filter-group">
      <div class="filter-title">Teams</div>
      <div class="filter-buttons" data-tag="team">
        <button data-value="ALL">ALL</button>
        <button>ATL</button><button>BOS</button><button>BKN</button><button>CHA</button><button>CHI</button><button>CLE</button>
        <button>DAL</button><button>DEN</button><button>DET</button><button>GSW</button><button>HOU</button><button>IND</button>
        <button>LAC</button><button>LAL</button><button>MEM</button><button>MIA</button><button>MIL</button><button>MIN</button>
        <button>NOP</button><button>NYK</button><button>OKC</button><button>ORL</button><button>PHI</button><button>PHX</button>
        <button>POR</button><button>SAC</button><button>SAS</button><button>TOR</button><button>UTA</button><button>WAS</button>
      </div>
    </div>

    <!-- ALERT TYPE FILTER -->
    <div class="filter-group">
      <div class="filter-title">Type</div>
      <div class="filter-buttons" data-tag="alert">
        <button data-value="ALL">ALL</button>
        <button data-value="milestones">MILESTONES</button>
        <button data-value="overtakes">OVERTAKES</button>
      </div>
    </div>

    <!-- RANKING FILTER -->
    <div class="filter-group">
      <div class="filter-title">Ranking</div>
      <div class="filter-buttons" data-tag="ranking">
        <button data-value="ALL">ALL</button>
        <button data-value="top10">TOP 10</button>
        <button data-value="top50">TOP 50</button>
        <button data-value="top100">TOP 100</button>
      </div>
    </div>

    <!-- DISABLE ALL -->
    <div class="filter-group">
      <button class="disable-btn" onclick="disableNotifications()">
        Disable notifications
      </button>
    </div>

    <button class="save-btn" onclick="saveFilters()">Save</button>
  </div>
</div>

<!-- ‚úÖ INICIALIZACI√ìN DE ONESIGNAL - SOLO INIT, NADA M√ÅS -->
<script>
window.OneSignalDeferred = window.OneSignalDeferred || [];

OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
        appId: "7d1985a1-b7ee-42b0-b0c6-089032fd8124",
        allowLocalhostAsSecureOrigin: true,
    });
    console.log("‚úÖ OneSignal inicializado");
});
</script>

<script>
async function openFilters(){
    OneSignalDeferred.push(async function(OneSignal){
        // Pedir permisos si no los tiene
        const permission = await OneSignal.Notifications.permission;
        if(permission === 'default'){
            const granted = await OneSignal.Notifications.requestPermission();
            if(!granted){
                alert('You need to allow notifications to configure preferences.');
                return;
            }
        }
        
        const overlay = document.getElementById('notif-overlay');
        overlay.classList.remove('hidden');
        
        try {
            const tags = await OneSignal.User.getTags();
            const disableBtn = overlay.querySelector('.disable-btn');
            
            // Si est√° deshabilitado
            if(tags.disabled === 'true'){
                disableBtn.classList.add('active');
                overlay.querySelectorAll('.filter-buttons button').forEach(b => {
                    b.classList.remove('active');
                });
                return;
            }
            
            // Por defecto: TODO en ALL
            disableBtn.classList.remove('active');
            overlay.querySelectorAll('.filter-buttons button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Cargar filtros guardados o poner ALL por defecto
            overlay.querySelectorAll('.filter-buttons').forEach(group => {
                const key = group.dataset.tag;
                const savedValue = tags[key];
                
                if(!savedValue || savedValue === 'ALL'){
                    const allBtn = group.querySelector('[data-value="ALL"]');
                    if(allBtn) allBtn.classList.add('active');
                } else {
                    const values = savedValue.split(',');
                    values.forEach(val => {
                        const btn = group.querySelector(`button[data-value="${val}"]`) || 
                                   [...group.querySelectorAll('button')].find(b => b.textContent.trim() === val);
                        if(btn) btn.classList.add('active');
                    });
                }
            });
            
        } catch(error) {
            console.error("Error cargando tags:", error);
            // Si hay error: TODO en ALL
            overlay.querySelectorAll('.filter-buttons').forEach(group=>{
                group.querySelectorAll('button').forEach(btn=>{
                    if(btn.dataset.value === 'ALL') btn.classList.add('active');
                    else btn.classList.remove('active');
                });
            });
        }
    });
}

function closeFilters(){
    document.getElementById('notif-overlay').classList.add('hidden');
}
</script>   
<script>
document.querySelectorAll('.filter-buttons').forEach(group=>{
    const isExclusive = ['alert','ranking'].includes(group.dataset.tag);

    group.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click',()=>{
            // ‚úÖ Al pulsar cualquier filtro, desactivar "disable" y restaurar "ALL"
            const disableBtn = document.querySelector('.disable-btn');
            
            // Si "disable" est√° activo, restaurar todos los "ALL"
            if(disableBtn.classList.contains('active')){
                disableBtn.classList.remove('active');
                
                // ‚úÖ ACTIVAR TODOS LOS "ALL" DE TODOS LOS GRUPOS
                document.querySelectorAll('.filter-buttons').forEach(g=>{
                    g.querySelectorAll('button').forEach(b=>{
                        if(b.dataset.value === 'ALL'){
                            b.classList.add('active');
                        } else {
                            b.classList.remove('active');
                        }
                    });
                });
                
                // Borrar tag de disabled en OneSignal
                OneSignalDeferred.push(async function(OneSignal){
                    await OneSignal.User.removeTag('disabled');
                });
            }
            
            // ‚úÖ L√ìGICA NORMAL DE CLICK (igual que antes)
            if(btn.dataset.value === 'ALL'){
                group.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
                btn.classList.add('active');
                return;
            }

            group.querySelector('[data-value="ALL"]').classList.remove('active');

            if(isExclusive){
                group.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
                btn.classList.add('active');
            }else{
                btn.classList.toggle('active');
            }
        });
    });
});
</script>
<script>
async function saveFilters(){
    const tags = {};

    document.querySelectorAll('.filter-buttons').forEach(group=>{
        const key = group.dataset.tag;
        const values = [...group.querySelectorAll('button.active')]
            .map(b=>b.dataset.value || b.textContent)
            .filter(v=>v!=='ALL');

        if(values.length){
            tags[key] = values.join(',');
        }
    });

    OneSignalDeferred.push(async function(OneSignal){
        await OneSignal.User.addTags(tags);
        console.log('‚úÖ Preferences saved:', tags);
    });
    
    // Cerrar el panel inmediatamente
    closeFilters();
}

function disableNotifications(){
    // activar visualmente el bot√≥n
    const disableBtn = document.querySelector('.disable-btn');
    disableBtn.classList.add('active');

    // apagar TODOS los filtros
    document.querySelectorAll('.filter-buttons button')
        .forEach(b => b.classList.remove('active'));

    // mandar tag a OneSignal
    OneSignalDeferred.push(async function(OneSignal){
        await OneSignal.User.addTags({disabled:'true'});
    });
}
</script>

<!-- TU JAVASCRIPT ORIGINAL COMPLETO (data.json, tablas, etc.) -->
<script>
let DATA_CACHE={};
let DATA_LAST_FETCH=0;
let tInterval;

async function fetchData(){
    const now=Date.now();
    if(now-DATA_LAST_FETCH<10000&&Object.keys(DATA_CACHE).length){
        return DATA_CACHE;
    }
    const cb='?t='+now;
    const resp=await fetch('data.json'+cb);
    const data=await resp.json();
    DATA_CACHE=data;
    DATA_LAST_FETCH=now;
    return data;
}

function switchTab(tabName){
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
    if(tabName==='latest-moves'){
        document.querySelectorAll('.tab-btn')[0].classList.add('active');
        document.getElementById('tab-latest-moves').classList.add('active');
    }else{
        document.querySelectorAll('.tab-btn')[1].classList.add('active');
        document.getElementById('tab-live-rankings').classList.add('active');
    }
}

async function updateLatestMoves(){
    const d=await fetchData();
    const notifs=d.notificaciones||[];
    const ul=document.getElementById('moves-list');
    if(!notifs.length){
        ul.innerHTML='<p style="text-align:center;color:#888;margin-top:60px;">No hay movimientos recientes.</p>';
        return;
    }
    ul.innerHTML='';
    notifs.slice().reverse().forEach(n=>{
        const div=document.createElement('div');
        div.className='move-item';
        let html='';
        if(n.foto&&n.foto.length){
            const cClass='c'+n.foto.length;
            if(n.foto.length===1){
                html+=`<div class="collage ${cClass}"><img src="${n.foto[0]}"></div>`;
            }else if(n.foto.length===2){
                html+=`<div class="collage ${cClass}">`;
                n.foto.forEach(f=>html+=`<img src="${f}">`);
                html+='</div>';
            }else if(n.foto.length===3){
                html+=`<div class="collage ${cClass}">`;
                html+=`<div class="left"><img src="${n.foto[0]}"></div>`;
                html+=`<div class="right"><img src="${n.foto[1]}"><img src="${n.foto[2]}"></div>`;
                html+='</div>';
            }else if(n.foto.length===4){
                html+=`<div class="collage ${cClass}">`;
                n.foto.forEach(f=>html+=`<img src="${f}">`);
                html+='</div>';
            }
        }
        html+=`<div class="move-text">${n.texto||''}</div>`;
        if(n.timestamp){
            const d2=new Date(n.timestamp*1000);
            const hh=String(d2.getHours()).padStart(2,'0');
            const mm=String(d2.getMinutes()).padStart(2,'0');
            html+=`<div class="move-time">${hh}:${mm}</div>`;
        }
        div.innerHTML=html;
        ul.appendChild(div);
    });
}

async function updateLiveRankings(){
    const d=await fetchData();
    const tablas=d.tablas||{};
    const allStats=Object.keys(tablas);
    const fc=document.getElementById('filters-container');
    fc.innerHTML='';
    const btnAll=document.createElement('button');
    btnAll.className='filter-btn active';
    btnAll.textContent='ALL';
    btnAll.onclick=()=>filterStat('ALL');
    fc.appendChild(btnAll);
    allStats.forEach(s=>{
        const btn=document.createElement('button');
        btn.className='filter-btn';
        btn.textContent=s;
        btn.onclick=()=>filterStat(s);
        fc.appendChild(btn);
    });
    window.currentStat='ALL';
    renderRankings();
}

function filterStat(s){
    window.currentStat=s;
    document.querySelectorAll('#filters-container .filter-btn').forEach(b=>{
        if((s==='ALL'&&b.textContent==='ALL')||b.textContent===s){
            b.classList.add('active');
        }else{
            b.classList.remove('active');
        }
    });
    renderRankings();
}

function renderRankings(){
    const tablas=DATA_CACHE.tablas||{};
    const rc=document.getElementById('ranking-container');
    rc.innerHTML='';
    const s=window.currentStat||'ALL';
    const show=(s==='ALL')?Object.keys(tablas):[s];
    show.forEach(st=>{
        if(!tablas[st])return;
        const card=document.createElement('div');
        card.className='card';
        card.innerHTML=`<h2>${st}</h2>`;
        const table=document.createElement('table');
        const thead=document.createElement('thead');
        thead.innerHTML='<tr><th class="rank">Rank</th><th class="player">Player</th><th class="number">Team</th><th class="today">Hoy</th><th class="number">Total</th><th class="diff">Diff</th></tr>';
        table.appendChild(thead);
        const tbody=document.createElement('tbody');
        tablas[st].forEach(r=>{
            const tr=document.createElement('tr');
            let cls='';
            if(r.game_status==='live')cls='‚úÖ';
            else if(r.game_status==='final')cls='‚úîÔ∏è';
            else if(r.game_status==='upcoming')cls='‚è∏';
            const diffClass=(r.Diff&&r.Diff!=='0')?'diff-blink':'diff';
            tr.innerHTML=`<td class="rank">${r.Rank}</td><td class="player">${cls} ${r.Nombre}</td><td class="number">${r.Team}</td><td class="today">${r.Hoy}</td><td class="number">${r.Total}</td><td class="${diffClass}">${r.Diff||''}</td>`;
            tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        card.appendChild(table);
        rc.appendChild(card);
    });
}

async function updateStatusBar(){
    const d=await fetchData();
    const sb=document.getElementById('status-bar');
    const ua=d.ultima_actualizacion||'--:--:--';
    const numN=(d.notificaciones||[]).length;
    sb.innerHTML=`<div class="status-line1">Live üî¥</div><div class="status-line2">Updated: ${ua} | Moves: ${numN}</div>`;
}

async function refreshAll(){
    await fetchData();
    updateStatusBar();
    updateLatestMoves();
    updateLiveRankings();
}

window.addEventListener('DOMContentLoaded',async()=>{
    console.log('üîç DEBUG: P√°gina cargada');
    console.log('üîç DEBUG: Panel tiene clase hidden?', document.getElementById('notif-overlay').classList.contains('hidden'));
    await refreshAll();
    tInterval=setInterval(refreshAll,30000);
});
</script>
</body>
</html>
